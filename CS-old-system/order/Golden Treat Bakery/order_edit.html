<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Edit Order</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="navbar-placeholder"></div>

<section id="sub-pages">
  <div class="subpages_box">
    <a href="order_placement.html" class="btn subpage-btn">Place Order</a>
    <a href="order_edit.html" class="btn subpage-btn">Edit Orders</a>
    <a href="order_tracking.html" class="btn subpage-btn">Track Order</a>
    <a href="order_history.html" class="btn subpage-btn">History</a>
  </div>
</section>  

  <main class="container my-5">
    <h1 class="h5">Edit / Cancel Order</h1>
    <p class="text-muted">You can edit or cancel orders while they are <strong>Pending</strong>.</p>

    <div id="order-box" class="card p-3" style="display:none;">
      <div class="mb-2"><strong>Order ID:</strong> <span id="edit-order-id">—</span></div>
      <div class="mb-2"><strong>Status:</strong> <span id="edit-status">—</span></div>

      <ul id="edit-order-items" class="list-group mb-3"></ul>

      <div class="mb-3">
        <button id="apply-changes" class="btn btn-primary">Save changes</button>
        <button id="cancel-order" class="btn btn-danger ms-2">Cancel order</button>
      </div>

      <div id="edit-msg" class="mt-2"></div>
    </div>

    <div id="missing-box" class="alert alert-warning">No order found. Open this page with `order_edit.html?order_id=TSH-...`</div>
  </main>

  <div id="footer-placeholder"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="js/script.js"></script>
  <script>
    // very small client-side demo logic
    function qs(name){ return new URLSearchParams(location.search).get(name); }
    const id = qs('order_id');
    const ORDERS_API = '/api/orders'; // replace with your API

    function formatN(n){ return (n||0).toLocaleString('en-LK'); }
    function demoLoad(){ // demo data when no backend
      return { order_id: id || 'TSH-20250815-001', status: 'pending', items: [{title:'Beef Burger',qty:1,price:850},{title:'Fries',qty:2,price:350}] };
    }

    (function init(){
      if(!id){ document.getElementById('order-box').style.display='none'; return; }
      document.getElementById('missing-box').style.display='none';
      const data = demoLoad();
      document.getElementById('order-box').style.display='block';
      document.getElementById('edit-order-id').textContent = data.order_id;
      document.getElementById('edit-status').textContent = data.status;
      const ul = document.getElementById('edit-order-items');
      ul.innerHTML = '';
      data.items.forEach((it, idx) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex align-items-center';
        li.innerHTML = `<div class="flex-grow-1">
                          <div class="fw-semibold">${it.title}</div>
                        </div>
                        <div style="width:120px">
                          <input type="number" min="1" value="${it.qty}" data-idx="${idx}" class="form-control form-control-sm item-qty" />
                        </div>
                        <div class="ms-3 fw-semibold">LKR ${formatN(it.price*it.qty)}</div>`;
        ul.appendChild(li);
      });

      // only allow edits when pending
      if(data.status !== 'pending'){
        document.getElementById('apply-changes').disabled = true;
        document.getElementById('cancel-order').disabled = true;
        document.getElementById('edit-msg').innerHTML = '<div class="text-muted">Order cannot be modified - not in Pending state.</div>';
      }

      document.getElementById('apply-changes').addEventListener('click', ()=>{
        // gather new qtys and POST/PATCH to server
        document.getElementById('edit-msg').innerHTML = 'Saving changes... (implement server endpoint)';
        setTimeout(()=> document.getElementById('edit-msg').innerHTML = '<div class="text-success">Changes saved (demo).</div>'), 700;
      });
      document.getElementById('cancel-order').addEventListener('click', ()=>{
        if(!confirm('Cancel this order?')) return;
        document.getElementById('edit-msg').innerHTML = 'Cancelling order... (implement server endpoint)';
        setTimeout(()=> document.getElementById('edit-msg').innerHTML = '<div class="text-success">Order cancelled (demo).</div>'), 700;
      });
    })();
  </script>

</body>
</html>
